"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[595],{4063:function(t){t.exports=function t(e,r){if(e===r)return!0;if(e&&r&&"object"==typeof e&&"object"==typeof r){if(e.constructor!==r.constructor)return!1;if(Array.isArray(e)){if((n=e.length)!=r.length)return!1;for(a=n;0!=a--;)if(!t(e[a],r[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if((n=(i=Object.keys(e)).length)!==Object.keys(r).length)return!1;for(a=n;0!=a--;)if(!Object.prototype.hasOwnProperty.call(r,i[a]))return!1;for(a=n;0!=a--;){var n,a,i,o=i[a];if(!t(e[o],r[o]))return!1}return!0}return e!=e&&r!=r}},6595:function(t,e,r){r.r(e),r.d(e,{groq:function(){return a.Z},groqStore:function(){return tC}});var n,a=r(7288),i=r(4063);class o{constructor(t){this.pattern=t,this.patternRe=function(t){let e=[];for(let r of t.split("."))"*"===r?e.push("[^.]+"):"**"===r?e.push(".*"):e.push(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));return RegExp("^".concat(e.join("."),"$"))}(t)}matches(t){return this.patternRe.test(t)}toJSON(){return this.pattern}}class s{constructor(t){this.type="stream",this.generator=t,this.ticker=null,this.isDone=!1,this.data=[]}isArray(){return!0}async get(){let t=[];for await(let e of this)t.push(await e.get());return t}async *[Symbol.asyncIterator](){let t=0;for(;;){for(;t<this.data.length;t++)yield this.data[t];if(this.isDone)return;await this._nextTick()}}_nextTick(){let t;if(this.ticker)return this.ticker;let e=()=>{this.ticker=new Promise(e=>{t=e})},r=()=>{t(),e()},n=async()=>{for await(let t of this.generator())this.data.push(t),r();this.isDone=!0,r()};return e(),n(),this.ticker}}let c=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function u(t,e){let r=t.toString();for(;r.length<e;)r="0".concat(r);return r}class l{constructor(t,e){this.data=t,this.type=e}isArray(){return"array"===this.type}async get(){return this.data}[Symbol.asyncIterator](){if(Array.isArray(this.data))return function*(t){for(let e of t)yield w(e)}(this.data);throw Error("Cannot iterate over: ".concat(this.type))}}let p=new l(null,"null"),f=new l(!0,"boolean"),y=new l(!1,"boolean");class d{constructor(t){this.date=t}static parseToValue(t){let e=c.test(t)?new Date(t):null;return e?new l(new d(e),"datetime"):p}equals(t){return this.date.getTime()==t.date.getTime()}add(t){let e=new Date(this.date.getTime());return e.setTime(e.getTime()+1e3*t),new d(e)}difference(t){return(this.date.getTime()-t.date.getTime())/1e3}compareTo(t){return this.date.getTime()-t.date.getTime()}toString(){return function(t){let e=u(t.getUTCFullYear(),4),r=u(t.getUTCMonth()+1,2),n=u(t.getUTCDate(),2),a=u(t.getUTCHours(),2),i=u(t.getUTCMinutes(),2),o=u(t.getUTCSeconds(),2),s="",c=t.getMilliseconds();return 0!=c&&(s=".".concat(u(c,3))),"".concat(e,"-").concat(r,"-").concat(n,"T").concat(a,":").concat(i,":").concat(o).concat(s,"Z")}(this.date)}toJSON(){return this.toString()}}function h(t){return Number.isFinite(t)?new l(t,"number"):p}function m(t){return new l(t,"string")}function b(t){return new l(t,"datetime")}function w(t){return t&&"function"==typeof t.next?new s(async function*(){for await(let e of t)yield w(e)}):null==t?p:new l(t,g(t))}function g(t){return null==t?"null":Array.isArray(t)?"array":t instanceof o?"path":t instanceof d?"datetime":typeof t}function k(t,e){return"string"===t.type&&"string"===e.type||"boolean"===t.type&&"boolean"===e.type||"null"===t.type&&"null"===e.type||"number"===t.type&&"number"===e.type?t.data===e.data:"datetime"===t.type&&"datetime"===e.type&&t.data.equals(e.data)}let v=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,E=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,S=/(\b\.+|\.+\b)/g;function A(t){return t.replace(S,"").match(v)||[]}function _(t){let e=t.replace(S,"").match(E)||[];return e.map(t=>RegExp("^".concat(t.slice(0,1024).replace(/\*/g,".*"),"$"),"i"))}async function j(t,e){if("string"===t.type)return e(t.data),!0;if(t.isArray()){let r=!0;for await(let n of t)"string"===n.type?e(n.data):r=!1;return r}return!1}let x={datetime:1,number:2,string:3,boolean:4};function O(t,e){let r=g(t),n=g(e);if(r!==n)return null;switch(r){case"number":case"boolean":return t-e;case"string":if(t<e)return -1;if(t>e)return 1;return 0;case"datetime":return t.compareTo(e);default:return null}}let I={"==":function(t,e){return k(t,e)?f:y},"!=":function(t,e){return k(t,e)?y:f},">":function(t,e){if("stream"===t.type||"stream"===e.type)return p;let r=O(t.data,e.data);return null===r?p:r>0?f:y},">=":function(t,e){if("stream"===t.type||"stream"===e.type)return p;let r=O(t.data,e.data);return null===r?p:r>=0?f:y},"<":function(t,e){if("stream"===t.type||"stream"===e.type)return p;let r=O(t.data,e.data);return null===r?p:r<0?f:y},"<=":function(t,e){if("stream"===t.type||"stream"===e.type)return p;let r=O(t.data,e.data);return null===r?p:r<=0?f:y},in:async function(t,e){if("path"===e.type)return"string"!==t.type?p:e.data.matches(t.data)?f:y;if(e.isArray()){for await(let r of e)if(k(t,r))return f;return y}return p},match:async function(t,e){var r,n;let a=[],i=[];await j(t,t=>{a=a.concat(A(t))});let o=await j(e,t=>{i=i.concat(function(t){let e=_(t);return e.map(t=>e=>e.some(e=>t.test(e)))}(t))});if(!o)return y;let s=(r=a,n=i,0!==r.length&&0!==n.length&&n.every(t=>t(r)));return s?f:y},"+":function(t,e){return"datetime"===t.type&&"number"===e.type?b(t.data.add(e.data)):"number"===t.type&&"number"===e.type?h(t.data+e.data):"string"===t.type&&"string"===e.type?m(t.data+e.data):"object"===t.type&&"object"===e.type?w({...t.data,...e.data}):"array"===t.type&&"array"===e.type?w(t.data.concat(e.data)):t.isArray()&&e.isArray()?new s(async function*(){for await(let e of t)yield e;for await(let t of e)yield t}):p},"-":function(t,e){return"datetime"===t.type&&"number"===e.type?b(t.data.add(-e.data)):"datetime"===t.type&&"datetime"===e.type?h(t.data.difference(e.data)):"number"===t.type&&"number"===e.type?h(t.data-e.data):p},"*":P((t,e)=>t*e),"/":P((t,e)=>t/e),"%":P((t,e)=>t%e),"**":P((t,e)=>Math.pow(t,e))};function P(t){return function(e,r){if("number"===e.type&&"number"===r.type){let n=t(e.data,r.data);return h(n)}return p}}class C{constructor(t,e,r,n,a){this.isHidden=!1,this.params=t,this.source=e,this.value=r,this.context=n,this.parent=a}createNested(t){return this.isHidden?new C(this.params,this.source,t,this.context,this.parent):new C(this.params,this.source,t,this.context,this)}createHidden(t){let e=this.createNested(t);return e.isHidden=!0,e}}function T(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T,n=F[t.type];return n(t,e,r)}function V(t,e){return"then"in t?t.then(e):e(t)}let F={This:(t,e)=>e.value,Selector(){throw Error("Selectors can not be evaluated")},Everything:(t,e)=>e.source,Parameter(t,e){let{name:r}=t;return w(e.params[r])},Context(t,e){let{key:r}=t;if("before"===r||"after"===r){let t=e.context[r];return t||p}throw Error("unknown context key: ".concat(r))},Parent(t,e){let{n:r}=t,n=e;for(let t=0;t<r;t++){if(!n.parent)return p;n=n.parent}return n.value},OpCall(t,e,r){let{op:n,left:a,right:i}=t,o=I[n];if(!o)throw Error("Unknown operator: ".concat(n));let s=r(a,e),c=r(i,e);return"then"in s||"then"in c?(async()=>o(await s,await c))():o(s,c)},async Select(t,e,r){let{alternatives:n,fallback:a}=t;for(let t of n){let n=await r(t.condition,e);if("boolean"===n.type&&!0===n.data)return r(t.value,e)}return a?r(a,e):p},async InRange(t,e,r){let{base:n,left:a,right:i,isInclusive:o}=t,s=await r(n,e),c=await r(a,e),u=await r(i,e),l=O(await s.get(),await c.get());if(null===l)return p;let d=O(await s.get(),await u.get());return null===d?p:o?l>=0&&d<=0?f:y:l>=0&&d<0?f:y},async Filter(t,e,r){let{base:n,expr:a}=t,i=await r(n,e);return i.isArray()?new s(async function*(){for await(let t of i){let n=e.createNested(t),i=await r(a,n);"boolean"===i.type&&!0===i.data&&(yield t)}}):p},async Projection(t,e,r){let{base:n,expr:a}=t,i=await r(n,e);if("object"!==i.type)return p;let o=e.createNested(i);return r(a,o)},FuncCall(t,e,r){let{func:n,args:a}=t;return n(a,e,r)},async PipeFuncCall(t,e,r){let{func:n,base:a,args:i}=t,o=await r(a,e);return n(o,i,e,r)},async AccessAttribute(t,e,r){let{base:n,name:a}=t,i=e.value;return(n&&(i=await r(n,e)),"object"===i.type&&i.data.hasOwnProperty(a))?w(i.data[a]):p},async AccessElement(t,e,r){let{base:n,index:a}=t,i=await r(n,e);if(!i.isArray())return p;let o=await i.get(),s=a<0?a+o.length:a;return w(o[s])},async Slice(t,e,r){let{base:n,left:a,right:i,isInclusive:o}=t,s=await r(n,e);if(!s.isArray())return p;let c=await s.get(),u=a,l=i;return u<0&&(u=c.length+u),l<0&&(l=c.length+l),o&&l++,u<0&&(u=0),l<0&&(l=0),w(c.slice(u,l))},async Deref(t,e,r){let{base:n}=t,a=await r(n,e);if(!e.source.isArray()||"object"!==a.type)return p;let i=a.data._ref;if("string"!=typeof i)return p;for await(let t of e.source)if("object"===t.type&&i===t.data._id)return t;return p},Value(t){let{value:e}=t;return w(e)},Group(t,e,r){let{base:n}=t;return r(n,e)},async Object(t,e,r){let{attributes:n}=t,a={};for(let t of n){let n=t.type;switch(t.type){case"ObjectAttributeValue":{let n=await r(t.value,e);a[t.name]=await n.get();break}case"ObjectConditionalSplat":{let n=await r(t.condition,e);if("boolean"!==n.type||!1===n.data)continue;let i=await r(t.value,e);"object"===i.type&&Object.assign(a,i.data);break}case"ObjectSplat":{let n=await r(t.value,e);"object"===n.type&&Object.assign(a,n.data);break}default:throw Error("Unknown node type: ".concat(n))}}return w(a)},Array(t,e,r){let{elements:n}=t;return new s(async function*(){for(let t of n){let n=await r(t.value,e);if(t.isSplat){if(n.isArray())for await(let t of n)yield t}else yield n}})},Tuple(){throw Error("tuples can not be evaluated")},async Or(t,e,r){let{left:n,right:a}=t,i=await r(n,e),o=await r(a,e);return"boolean"===i.type&&!0===i.data||"boolean"===o.type&&!0===o.data?f:"boolean"!==i.type||"boolean"!==o.type?p:y},async And(t,e,r){let{left:n,right:a}=t,i=await r(n,e),o=await r(a,e);return"boolean"===i.type&&!1===i.data||"boolean"===o.type&&!1===o.data?y:"boolean"!==i.type||"boolean"!==o.type?p:f},async Not(t,e,r){let{base:n}=t,a=await r(n,e);return"boolean"!==a.type?p:a.data?y:f},Neg(t,e,r){let{base:n}=t;return V(r(n,e),t=>"number"!==t.type?p:h(-t.data))},Pos(t,e,r){let{base:n}=t;return V(r(n,e),t=>"number"!==t.type?p:h(t.data))},Asc:()=>p,Desc:()=>p,async ArrayCoerce(t,e,r){let{base:n}=t,a=await r(n,e);return a.isArray()?a:p},async Map(t,e,r){let{base:n,expr:a}=t,i=await r(n,e);return i.isArray()?new s(async function*(){for await(let t of i){let n=e.createHidden(t);yield await r(a,n)}}):p},async FlatMap(t,e,r){let{base:n,expr:a}=t,i=await r(n,e);return i.isArray()?new s(async function*(){for await(let t of i){let n=e.createHidden(t),i=await r(a,n);if(i.isArray())for await(let t of i)yield t;else yield i}}):p}},R=new C({},p,p,{timestamp:new Date(0),identity:"me",before:null,after:null},null);function M(t){return!function t(e){switch(e.type){case"Group":case"Value":case"Parameter":return!0;case"Pos":case"Neg":return t(e.base);case"OpCall":switch(e.op){case"+":case"-":case"*":case"/":case"%":case"**":return t(e.left)&&t(e.right);default:return!1}default:return!1}}(t)?null:function t(e){let r=T(e,R,t);if("then"in r)throw Error("BUG: constant evaluate should never return a promise");return r}(t)}async function D(t){if("object"===t.type)return U(t.data);if(t.isArray()){let e=await N(t);if(e.length>0)return e.join("\n\n")}return null}async function N(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for await(let r of t)if("object"===r.type){let t=U(r.data);null!==t&&e.push(t)}else r.isArray()&&await N(r,e);return e}function U(t){if("string"!=typeof t._type)return null;let e=t.children;if(!Array.isArray(e))return null;let r="";for(let t of e)t&&"object"==typeof t&&"string"==typeof t._type&&"span"===t._type&&"string"==typeof t.text&&(r+=t.text);return r}async function B(t,e,r){if("OpCall"===t.type&&"match"===t.op)return q(t.left,t.right,e,r);if("FuncCall"===t.type&&"boost"===t.name){let n=await B(t.args[0],e,r),a=await r(t.args[1],e);return"number"===a.type&&n>0?n+a.data:0}switch(t.type){case"Or":{let n=await B(t.left,e,r),a=await B(t.right,e,r);return n+a}case"And":{let n=await B(t.left,e,r),a=await B(t.right,e,r);if(0===n||0===a)return 0;return n+a}default:{let n=await r(t,e);return"boolean"===n.type&&!0===n.data?1:0}}}async function q(t,e,r,n){let a=await n(t,r),i=await n(e,r),o=[],s=[];await j(a,t=>{o=o.concat(A(t))});let c=await j(i,t=>{s=s.concat(_(t))});if(!c||0===o.length||0===s.length)return 0;let u=0;for(let t of s){let e=o.reduce((e,r)=>e+(t.test(r)?1:0),0);u+=2.2*e/(e+1.2)}return u}let z={};z.anywhere=async function(){throw Error("not implemented")},z.anywhere.arity=1,z.coalesce=async function(t,e,r){for(let n of t){let t=await r(n,e);if("null"!==t.type)return t}return p},z.count=async function(t,e,r){let n=await r(t[0],e);if(!n.isArray())return p;let a=0;for await(let t of n)a++;return h(a)},z.count.arity=1,z.dateTime=async function(t,e,r){let n=await r(t[0],e);return"datetime"===n.type?n:"string"!==n.type?p:d.parseToValue(n.data)},z.dateTime.arity=1,z.defined=async function(t,e,r){let n=await r(t[0],e);return"null"===n.type?y:f},z.defined.arity=1,z.identity=async function(t,e){return m(e.context.identity)},z.identity.arity=0,z.length=async function(t,e,r){let n=await r(t[0],e);if("string"===n.type)return h(function(t){let e=0;for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);(!(n>=55296)||!(n<=56319))&&e++}return e}(n.data));if(n.isArray()){let t=0;for await(let e of n)t++;return h(t)}return p},z.length.arity=1,z.path=async function(t,e,r){var n;let a=await r(t[0],e);return"string"!==a.type?p:(n=new o(a.data),new l(n,"path"))},z.path.arity=1,z.string=async function(t,e,r){let n=await r(t[0],e);switch(n.type){case"number":case"string":case"boolean":case"datetime":return m("".concat(n.data));default:return p}},z.string.arity=1,z.references=async function(t,e,r){let n=new Set;for(let a of t){let t=await r(a,e);if("string"===t.type)n.add(t.data);else if(t.isArray())for await(let e of t)"string"===e.type&&n.add(e.data)}if(0===n.size)return y;let a=await e.value.get();return!function t(e,r){switch(g(e)){case"array":for(let n of e)if(t(n,r))return!0;break;case"object":if(e._ref)return r.has(e._ref);for(let n of Object.values(e))if(t(n,r))return!0}return!1}(a,n)?y:f},z.references.arity=t=>t>=1,z.round=async function(t,e,r){let n=await r(t[0],e);if("number"!==n.type)return p;let a=n.data,i=0;if(2===t.length){let n=await r(t[1],e);if("number"!==n.type||n.data<0||!Number.isInteger(n.data))return p;i=n.data}return 0===i?a<0?h(-Math.round(-a)):h(Math.round(a)):h(Number(a.toFixed(i)))},z.round.arity=t=>t>=1&&t<=2,z.now=async function(t,e){return m(e.context.timestamp.toISOString())},z.now.arity=0,z.boost=async function(){throw Error("unexpected boost call")},z.boost.arity=2;let G={};G.lower=async function(t,e,r){let n=await r(t[0],e);return"string"!==n.type?p:m(n.data.toLowerCase())},G.lower.arity=1,G.upper=async function(t,e,r){let n=await r(t[0],e);return"string"!==n.type?p:m(n.data.toUpperCase())},G.upper.arity=1,G.split=async function(t,e,r){let n=await r(t[0],e);if("string"!==n.type)return p;let a=await r(t[1],e);return"string"!==a.type?p:0===n.data.length?w([]):0===a.data.length?w(Array.from(n.data)):w(n.data.split(a.data))},G.split.arity=2,z.lower=G.lower,z.upper=G.upper,G.startsWith=async function(t,e,r){let n=await r(t[0],e);if("string"!==n.type)return p;let a=await r(t[1],e);return"string"!==a.type?p:n.data.startsWith(a.data)?f:y},G.startsWith.arity=2;let K={};K.join=async function(t,e,r){let n=await r(t[0],e);if(!n.isArray())return p;let a=await r(t[1],e);if("string"!==a.type)return p;let i="",o=!1;for await(let t of n){switch(o&&(i+=a.data),t.type){case"number":case"string":case"boolean":case"datetime":i+="".concat(t.data);break;default:return p}o=!0}return w(i)},K.join.arity=2,K.compact=async function(t,e,r){let n=await r(t[0],e);return n.isArray()?new s(async function*(){for await(let t of n)"null"!==t.type&&(yield t)}):p},K.compact.arity=1,K.unique=async function(t,e,r){let n=await r(t[0],e);return n.isArray()?new s(async function*(){let t=new Set;for await(let e of n)switch(e.type){case"number":case"string":case"boolean":case"datetime":t.has(e.data)||(t.add(e.data),yield e);break;default:yield e}}):p},K.unique.arity=1;let W={};W.text=async function(t,e,r){let n=await r(t[0],e),a=await D(n);return null===a?p:m(a)},W.text.arity=1;let $={};$.projectId=async function(t,e){return e.context.sanity?m(e.context.sanity.projectId):p},$.dataset=async function(t,e){return e.context.sanity?m(e.context.sanity.dataset):p};let H={};H.order=async function(t,e,r,n){if(await !0,!t.isArray())return p;let a=[],i=[],o=0;for(let t of e){let e="asc";"Desc"===t.type?(e="desc",t=t.base):"Asc"===t.type&&(t=t.base),a.push(t),i.push(e),o++}let s=[],c=0;for await(let e of t){let t=r.createNested(e),i=[await e.get(),c];for(let e=0;e<o;e++){let r=await n(a[e],t);i.push(await r.get())}s.push(i),c++}return s.sort((t,e)=>{for(let r=0;r<o;r++){let n=function(t,e){let r=g(t),n=g(e),a=x[r]||100,i=x[n]||100;if(a!==i)return a-i;let o=O(t,e);return null===o&&(o=0),o}(t[r+2],e[r+2]);if("desc"===i[r]&&(n=-n),0!==n)return n}return t[1]-e[1]}),w(s.map(t=>t[0]))},H.order.arity=t=>t>=1,H.score=async function(t,e,r,n){if(!t.isArray())return p;let a=[],i=[];for await(let o of t){if("object"!==o.type){a.push(await o.get());continue}let t=r.createNested(o),s="number"==typeof o.data._score?o.data._score:0;for(let r of e)s+=await B(r,t,n);let c=Object.assign({},o.data,{_score:s});i.push(c)}return i.sort((t,e)=>e._score-t._score),w(i)},H.score.arity=t=>t>=1;let L={};L.operation=async function(t,e){let r=null!==e.context.before,n=null!==e.context.after;return r&&n?m("update"):n?m("create"):r?m("delete"):p},L.changedAny=()=>{throw Error("not implemented")},L.changedAny.arity=1,L.changedAny.mode="delta",L.changedOnly=()=>{throw Error("not implemented")},L.changedOnly.arity=1,L.changedOnly.mode="delta";let J={};J.changedAny=()=>{throw Error("not implemented")},J.changedAny.arity=3,J.changedOnly=()=>{throw Error("not implemented")},J.changedOnly.arity=3;let Z={};Z.min=async function(t,e,r){let n;let a=await r(t[0],e);if(!a.isArray())return p;for await(let t of a)if("null"!==t.type){if("number"!==t.type)return p;(void 0===n||t.data<n)&&(n=t.data)}return w(n)},Z.min.arity=1,Z.max=async function(t,e,r){let n;let a=await r(t[0],e);if(!a.isArray())return p;for await(let t of a)if("null"!==t.type){if("number"!==t.type)return p;(void 0===n||t.data>n)&&(n=t.data)}return w(n)},Z.max.arity=1,Z.sum=async function(t,e,r){let n=await r(t[0],e);if(!n.isArray())return p;let a=0;for await(let t of n)if("null"!==t.type){if("number"!==t.type)return p;a+=t.data}return w(a)},Z.sum.arity=1,Z.avg=async function(t,e,r){let n=await r(t[0],e);if(!n.isArray())return p;let a=0,i=0;for await(let t of n)if("null"!==t.type){if("number"!==t.type)return p;a+=t.data,i++}return 0===i?p:w(a/i)},Z.avg.arity=1;let Q={global:z,string:G,array:K,pt:W,delta:L,diff:J,sanity:$,math:Z};class Y{constructor(t,e,r){this.allowBoost=!1,this.string=t,this.marks=e,this.index=0,this.parseOptions=r}hasMark(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.index+t<this.marks.length}getMark(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.marks[this.index+t]}shift(){this.index+=1}process(t){let e=this.marks[this.index];this.shift();let r=t[e.name];if(!r)throw Error("Unknown handler: ".concat(e.name));return r.call(t,this,e)}processString(){return this.shift(),this.processStringEnd()}processStringEnd(){let t=this.marks[this.index-1],e=this.marks[this.index];return this.shift(),this.string.slice(t.position,e.position)}slice(t){let e=this.marks[this.index].position;return this.string.slice(e,e+t)}}let X=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,tt=/^\d+/,te=/^[a-zA-Z_][a-zA-Z_0-9]*/;function tr(t,e,r){let n,a,i=e;switch(t[e]){case"+":{let r=tr(t,to(t,e+1),10);if("error"===r.type)return r;n=[{name:"pos",position:i}].concat(r.marks),e=r.position;break}case"-":{let r=tr(t,to(t,e+1),8);if("error"===r.type)return r;n=[{name:"neg",position:i}].concat(r.marks),e=r.position;break}case"(":{let r=tr(t,to(t,e+1),0);if("error"===r.type)return r;switch(e=to(t,r.position),t[e]){case",":for(n=[{name:"tuple",position:i}].concat(r.marks),e=to(t,e+1);;){if("error"===(r=tr(t,e,0)).type)return r;if(e=to(t,r.position),","!==t[e])break;e=to(t,e+1)}if(")"!==t[e])return{type:"error",position:e};e++,n.push({name:"tuple_end",position:e});break;case")":e++,n=[{name:"group",position:i}].concat(r.marks);break;default:return{type:"error",position:e}}break}case"!":{let r=tr(t,to(t,e+1),10);if("error"===r.type)return r;n=[{name:"not",position:i}].concat(r.marks),e=r.position;break}case"{":{let r=ti(t,e);if("error"===r.type)return r;n=r.marks,e=r.position;break}case"[":if(n=[{name:"array",position:e}],e=to(t,e+1),"]"!==t[e])for(;;){"..."===t.slice(e,e+3)&&(n.push({name:"array_splat",position:e}),e=to(t,e+3));let r=tr(t,e,0);if("error"===r.type)return r;if(n=n.concat(r.marks),e=r.position,e=to(t,e),","!==t[e]||(e=to(t,e+1),"]"===t[e]))break}if("]"!==t[e])return{type:"error",position:e};e++,n.push({name:"array_end",position:e});break;case"'":case'"':{let r=function(t,e){let r=t[e];e+=1;let n=[{name:"str",position:e}];t:for(;;e++){if(e>t.length)return{type:"error",position:e};switch(t[e]){case r:n.push({name:"str_end",position:e}),e++;break t;case"\\":n.push({name:"str_pause",position:e}),"u"===t[e+1]?"{"===t[e+2]?(n.push({name:"unicode_hex",position:e+3}),e=t.indexOf("}",e+3),n.push({name:"unicode_hex_end",position:e})):(n.push({name:"unicode_hex",position:e+2}),n.push({name:"unicode_hex_end",position:e+6}),e+=5):(n.push({name:"single_escape",position:e+1}),e+=1),n.push({name:"str_start",position:e+1})}}return{type:"success",marks:n,position:e}}(t,e);if("error"===r.type)return r;n=r.marks,e=r.position;break}case"^":for(e++,n=[];"."===t[e]&&"^"===t[e+1];)n.push({name:"dblparent",position:i}),e+=2;n.push({name:"parent",position:i});break;case"@":n=[{name:"this",position:i}],e++;break;case"*":n=[{name:"everything",position:i}],e++;break;case"$":{let r=ts(t,e+1,te);r&&(e+=1+r,n=[{name:"param",position:i},{name:"ident",position:i+1},{name:"ident_end",position:e}]);break}default:{let r=ts(t,e,tt);if(r){let a="integer";if("."===t[e+=r]){let r=ts(t,e+1,tt);r&&(a="float",e+=1+r)}if("e"===t[e]||"E"===t[e]){a="sci",("+"===t[++e]||"-"===t[e])&&e++;let r=ts(t,e,tt);if(!r)return{type:"error",position:e};e+=r}n=[{name:a,position:i},{name:a+"_end",position:e}];break}let a=ts(t,e,te);if(a)switch(t[e+=a]){case":":case"(":{let r=ta(t,i,e);if("error"===r.type)return r;n=r.marks,e=r.position;break}default:n=[{name:"this_attr",position:i},{name:"ident",position:i},{name:"ident_end",position:e}]}}}if(!n)return{type:"error",position:e};let o=12;e:for(;;){let s=to(t,e);if(s===t.length){e=s;break}if("success"===(a=tn(t,s)).type){for(n.unshift({name:"traverse",position:i});"success"===a.type;)n=n.concat(a.marks),e=a.position,a=tn(t,to(t,e));n.push({name:"traversal_end",position:e});continue}switch(t[s]){case"=":switch(t[s+1]){case">":{if(r>1||o<=1)break e;let a=tr(t,to(t,s+2),1);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"pair",position:i}),e=a.position,o=1;break}case"=":{if(r>4||o<=4)break e;let a=tr(t,to(t,s+2),5);if("error"===a.type)return a;n.unshift({name:"comp",position:i}),n.push({name:"op",position:s},{name:"op_end",position:s+2}),n=n.concat(a.marks),e=a.position,o=4;break}default:break e}break;case"+":{if(r>6||o<6)break e;let a=tr(t,to(t,s+1),7);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"add",position:i}),e=a.position,o=6;break}case"-":{if(r>6||o<6)break e;let a=tr(t,to(t,s+1),7);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"sub",position:i}),e=a.position,o=6;break}case"*":{if("*"===t[s+1]){if(r>8||o<=8)break e;let a=tr(t,to(t,s+2),8);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"pow",position:i}),e=a.position,o=8;break}if(r>7||o<7)break e;let a=tr(t,to(t,s+1),8);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"mul",position:i}),e=a.position,o=7;break}case"/":{if(r>7||o<7)break e;let a=tr(t,to(t,s+1),8);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"div",position:i}),e=a.position,o=7;break}case"%":{if(r>7||o<7)break e;let a=tr(t,to(t,s+1),8);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"mod",position:i}),e=a.position,o=7;break}case"<":case">":{if(r>4||o<=4)break e;let a=s+1;"="===t[a]&&a++;let c=tr(t,to(t,a),5);if("error"===c.type)return c;n.unshift({name:"comp",position:i}),n.push({name:"op",position:s},{name:"op_end",position:a}),n=n.concat(c.marks),e=c.position,o=4;break}case"|":if("|"===t[s+1]){if(r>2||o<2)break e;let a=tr(t,to(t,s+2),3);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"or",position:i}),e=a.position,o=2}else{if(r>11||o<11)break e;let a=to(t,s+1),c=ts(t,a,te);if(!c)return{type:"error",position:a};if("("===t[e=a+c]||":"===t[e]){let r=ta(t,a,e);if("error"===r.type)return r;(n=n.concat(r.marks)).unshift({name:"pipecall",position:i}),e=r.position,o=11}}break;case"&":{if("&"!=t[s+1]||r>3||o<3)break e;let a=tr(t,to(t,s+2),4);if("error"===a.type)return a;(n=n.concat(a.marks)).unshift({name:"and",position:i}),e=a.position,o=3;break}case"!":{if("="!==t[s+1]||r>4||o<4)break e;let a=tr(t,to(t,s+2),5);if("error"===a.type)return a;n.unshift({name:"comp",position:i}),n.push({name:"op",position:s},{name:"op_end",position:s+2}),n=n.concat(a.marks),e=a.position,o=4;break}case"d":if("desc"!==t.slice(s,s+4)||r>4||o<4)break e;n.unshift({name:"desc",position:i}),e=s+4,o=4;break;case"a":if("asc"!==t.slice(s,s+3)||r>4||o<4)break e;n.unshift({name:"asc",position:i}),e=s+3,o=4;break;default:switch(function(t,e,r){let n=r.exec(t.slice(e));return n?n[0]:null}(t,s,te)){case"in":{if(r>4||o<=4)break e;e=to(t,s+2);let a=!1;"("===t[e]&&(a=!0,e=to(t,e+1));let c=e,u=tr(t,e,5);if("error"===u.type)return u;if(e=to(t,u.position),"."===t[e]&&"."===t[e+1]){let r="inc_range";"."===t[e+2]?(r="exc_range",e=to(t,e+3)):e=to(t,e+2);let a=tr(t,e,5);if("error"===a.type)return a;n.unshift({name:"in_range",position:i}),n=n.concat({name:r,position:c},u.marks,a.marks),e=a.position}else n.unshift({name:"comp",position:i}),n.push({name:"op",position:s},{name:"op_end",position:s+2}),n=n.concat(u.marks);if(a){if(e=to(t,e),")"!==t[e])return{type:"error",position:e};e++}o=4;break}case"match":{if(r>4||o<=4)break e;let a=tr(t,to(t,s+5),5);if("error"===a.type)return a;n.unshift({name:"comp",position:i}),n.push({name:"op",position:s},{name:"op_end",position:s+5}),n=n.concat(a.marks),e=a.position,o=4;break}default:break e}}}let s=(null==a?void 0:a.type)==="error"&&a.position;return{type:"success",marks:n,position:e,failPosition:s}}function tn(t,e){let r=e;switch(t[e]){case".":{let n=e=to(t,e+1),a=ts(t,e,te);if(!a)return{type:"error",position:e};return{type:"success",marks:[{name:"attr_access",position:r},{name:"ident",position:n},{name:"ident_end",position:e+=a}],position:e}}case"-":if(">"!==t[e+1])break;let n=[{name:"deref",position:r}],a=to(t,e+=2),i=ts(t,a,te);return i&&(e=a+i,n.push({name:"deref_attr",position:a},{name:"ident",position:a},{name:"ident_end",position:e})),{type:"success",marks:n,position:e};case"[":{if(e=to(t,e+1),"]"===t[e])return{type:"success",marks:[{name:"array_postfix",position:r}],position:e+1};let n=e,a=tr(t,e,0);if("error"===a.type)return a;if(e=to(t,a.position),"."===t[e]&&"."===t[e+1]){let i="inc_range";"."===t[e+2]?(i="exc_range",e+=3):e+=2,e=to(t,e);let o=tr(t,e,0);if("error"===o.type)return o;if(e=to(t,o.position),"]"!==t[e])return{type:"error",position:e};return{type:"success",marks:[{name:"slice",position:r},{name:i,position:n}].concat(a.marks,o.marks),position:e+1}}if("]"!==t[e])return{type:"error",position:e};return{type:"success",marks:[{name:"square_bracket",position:r}].concat(a.marks),position:e+1}}case"|":if(e=to(t,e+1),"{"===t[e]){let n=ti(t,e);if("error"===n.type)return n;return n.marks.unshift({name:"projection",position:r}),n}break;case"{":{let n=ti(t,e);if("error"===n.type)return n;return n.marks.unshift({name:"projection",position:r}),n}}return{type:"error",position:e}}function ta(t,e,r){let n=[];if(n.push({name:"func_call",position:e}),":"===t[r]&&":"===t[r+1]){n.push({name:"namespace",position:e}),n.push({name:"ident",position:e},{name:"ident_end",position:r}),r=to(t,r+2);let a=ts(t,r,te);if(!a||(n.push({name:"ident",position:r},{name:"ident_end",position:r+a}),r=to(t,r+a),"("!==t[r]))return{type:"error",position:r};r=to(t,++r)}else n.push({name:"ident",position:e},{name:"ident_end",position:r}),r=to(t,r+1);let a=r;if(")"!==t[r])for(;;){let e=tr(t,r,0);if("error"===e.type)return e;if(n=n.concat(e.marks),a=e.position,r=to(t,e.position),","!==t[r]||(r=to(t,r+1),")"===t[r]))break}return")"!==t[r]?{type:"error",position:r}:(n.push({name:"func_args_end",position:a}),{type:"success",marks:n,position:r+1})}function ti(t,e){let r=[{name:"object",position:e}];for(e=to(t,e+1);"}"!==t[e];){let n=e;if("..."===t.slice(e,e+3)){if(e=to(t,e+3),"}"!==t[e]&&","!==t[e]){let a=tr(t,e,0);if("error"===a.type)return a;r.push({name:"object_splat",position:n}),r=r.concat(a.marks),e=a.position}else r.push({name:"object_splat_this",position:n})}else{let a=tr(t,e,0);if("error"===a.type)return a;let i=to(t,a.position);if("str"===a.marks[0].name&&":"===t[i]){let o=tr(t,to(t,i+1),0);if("error"===o.type)return o;r.push({name:"object_pair",position:n}),r=r.concat(a.marks,o.marks),e=o.position}else r=r.concat({name:"object_expr",position:e},a.marks),e=a.position}if(e=to(t,e),","!==t[e])break;e=to(t,e+1)}return"}"!==t[e]?{type:"error",position:e}:(e++,r.push({name:"object_end",position:e}),{type:"success",marks:r,position:e})}function to(t,e){return e+ts(t,e,X)}function ts(t,e,r){let n=r.exec(t.slice(e));return n?n[0].length:0}function tc(t,e){return r=>e(t(r))}function tu(t){return e=>({type:"Map",base:e,expr:t({type:"This"})})}function tl(t,e){if(!e)return{type:"a-a",build:t};switch(e.type){case"a-a":return{type:"a-a",build:tc(t,e.build)};case"a-b":return{type:"a-b",build:tc(t,e.build)};case"b-b":return{type:"a-a",build:tc(t,tu(e.build))};case"b-a":var r;return{type:"a-a",build:tc(t,(r=e.build,t=>({type:"FlatMap",base:t,expr:r({type:"This"})})))};default:throw Error("unknown type: ".concat(e.type))}}function tp(t,e){if(!e)return{type:"b-b",build:t};switch(e.type){case"a-a":case"b-a":return{type:"b-a",build:tc(t,e.build)};case"a-b":case"b-b":return{type:"b-b",build:tc(t,e.build)};default:throw Error("unknown type: ".concat(e.type))}}let tf={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};class ty extends Error{constructor(){super(...arguments),this.name="GroqQueryError"}}let td={group(t){let e=t.process(td);return{type:"Group",base:e}},everything:()=>({type:"Everything"}),this:()=>({type:"This"}),parent:()=>({type:"Parent",n:1}),dblparent(t){let e=t.process(td);return{type:"Parent",n:e.n+1}},traverse(t){let e=t.process(td),r=[];for(;"traversal_end"!==t.getMark().name;)r.push(t.process(tm));t.shift();let n=null;for(let t=r.length-1;t>=0;t--)n=r[t](n);if(("Everything"===e.type||"Array"===e.type||"PipeFuncCall"===e.type)&&(n=tl(t=>t,n)),null===n)throw Error("BUG: unexpected empty traversal");return n.build(e)},this_attr(t){let e=t.processString();return"null"===e?{type:"Value",value:null}:"true"===e?{type:"Value",value:!0}:"false"===e?{type:"Value",value:!1}:{type:"AccessAttribute",name:e}},neg(t){let e=t.process(td);return{type:"Neg",base:e}},pos(t){let e=t.process(td);return{type:"Pos",base:e}},add(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"+",left:e,right:r}},sub(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"-",left:e,right:r}},mul(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"*",left:e,right:r}},div(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"/",left:e,right:r}},mod(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"%",left:e,right:r}},pow(t){let e=t.process(td),r=t.process(td);return{type:"OpCall",op:"**",left:e,right:r}},comp(t){let e=t.process(td),r=t.processString(),n=t.process(td);return{type:"OpCall",op:r,left:e,right:n}},in_range(t){let e=t.process(td),r="inc_range"===t.getMark().name;t.shift();let n=t.process(td),a=t.process(td);return{type:"InRange",base:e,left:n,right:a,isInclusive:r}},str(t){let e="";e:for(;t.hasMark();){let r=t.getMark();switch(r.name){case"str_end":e+=t.processStringEnd();break e;case"str_pause":e+=t.processStringEnd();break;case"str_start":t.shift();break;case"single_escape":{let r=t.slice(1);t.shift(),e+=tf[r];break}case"unicode_hex":t.shift(),e+=function(t){let e=parseInt(t,16);return String.fromCharCode(e)}(t.processStringEnd());break;default:throw Error("unexpected mark: ".concat(r.name))}}return{type:"Value",value:e}},integer(t){let e=t.processStringEnd();return{type:"Value",value:Number(e)}},float(t){let e=t.processStringEnd();return{type:"Value",value:Number(e)}},sci(t){let e=t.processStringEnd();return{type:"Value",value:Number(e)}},object(t){let e=[];for(;"object_end"!==t.getMark().name;)e.push(t.process(th));return t.shift(),{type:"Object",attributes:e}},array(t){let e=[];for(;"array_end"!==t.getMark().name;){let r=!1;"array_splat"===t.getMark().name&&(r=!0,t.shift());let n=t.process(td);e.push({type:"ArrayElement",value:n,isSplat:r})}return t.shift(),{type:"Array",elements:e}},tuple(t){let e=[];for(;"tuple_end"!==t.getMark().name;)e.push(t.process(td));return t.shift(),{type:"Tuple",members:e}},func_call(t){let e="global";"namespace"===t.getMark().name&&(t.shift(),e=t.processString());let r=t.processString();if("global"===e&&"select"===r){let e={type:"Select",alternatives:[]};for(;"func_args_end"!==t.getMark().name;)if("pair"===t.getMark().name){if(e.fallback)throw new ty("unexpected argument to select()");t.shift();let r=t.process(td),n=t.process(td);e.alternatives.push({type:"SelectAlternative",condition:r,value:n})}else{if(e.fallback)throw new ty("unexpected argument to select()");let r=t.process(td);e.fallback=r}return t.shift(),e}let n=[];for(;"func_args_end"!==t.getMark().name;){var a,i;(a=e,i=n.length,"diff"==a&&2==i&&["changedAny","changedOnly"].includes(r))?(t.process(tb),n.push({type:"Selector"})):n.push(t.process(td))}if(t.shift(),"global"===e&&("before"===r||"after"===r)&&"delta"===t.parseOptions.mode)return{type:"Context",key:r};if("global"===e&&"boost"===r&&!t.allowBoost)throw new ty("unexpected boost");let o=Q[e];if(!o)throw new ty("Undefined namespace: ".concat(e));let s=o[r];if(!s||(void 0!==s.arity&&tw(r,s.arity,n.length),void 0!==s.mode&&s.mode!==t.parseOptions.mode))throw new ty("Undefined function: ".concat(r));return{type:"FuncCall",func:s,name:r,args:n}},pipecall(t){let e=t.process(td);t.shift();let r="global";if("namespace"===t.getMark().name&&(t.shift(),r=t.processString()),"global"!==r)throw new ty("Undefined namespace: ".concat(r));let n=t.processString(),a=[],i=t.allowBoost;for("score"===n&&(t.allowBoost=!0);;){let e=t.getMark().name;if("func_args_end"===e)break;if("order"===n){if("asc"===e){t.shift(),a.push({type:"Asc",base:t.process(td)});continue}if("desc"===e){t.shift(),a.push({type:"Desc",base:t.process(td)});continue}}a.push(t.process(td))}t.shift(),t.allowBoost=i;let o=H[n];if(!o)throw new ty("Undefined pipe function: ".concat(n));return o.arity&&tw(n,o.arity,a.length),{type:"PipeFuncCall",func:o,base:e,name:n,args:a}},pair(t){throw new ty("unexpected =>")},and(t){let e=t.process(td),r=t.process(td);return{type:"And",left:e,right:r}},or(t){let e=t.process(td),r=t.process(td);return{type:"Or",left:e,right:r}},not(t){let e=t.process(td);return{type:"Not",base:e}},asc(t){throw new ty("unexpected asc")},desc(t){throw new ty("unexpected desc")},param(t){let e=t.processString();return t.parseOptions.params&&t.parseOptions.params.hasOwnProperty(e)?{type:"Value",value:t.parseOptions.params[e]}:{type:"Parameter",name:e}}},th={object_expr(t){if("pair"===t.getMark().name){t.shift();let e=t.process(td),r=t.process(td);return{type:"ObjectConditionalSplat",condition:e,value:r}}let e=t.process(td);return{type:"ObjectAttributeValue",name:function t(e){if("AccessAttribute"===e.type&&!e.base)return e.name;if("Deref"===e.type||"Map"===e.type||"Projection"===e.type||"Slice"===e.type||"Filter"===e.type||"AccessElement"===e.type||"ArrayCoerce"===e.type)return t(e.base);throw new ty("Cannot determine property key for type: ".concat(e.type))}(e),value:e}},object_pair(t){let e=t.process(td);if("Value"!==e.type)throw Error("name must be string");let r=t.process(td);return{type:"ObjectAttributeValue",name:e.value,value:r}},object_splat(t){let e=t.process(td);return{type:"ObjectSplat",value:e}},object_splat_this:()=>({type:"ObjectSplat",value:{type:"This"}})},tm={square_bracket(t){let e=t.process(td),r=M(e);return r&&"number"===r.type?t=>(function(t,e){if(!e)return{type:"a-b",build:t};switch(e.type){case"a-a":case"b-a":return{type:"a-a",build:tc(t,e.build)};case"a-b":case"b-b":return{type:"a-b",build:tc(t,e.build)};default:throw Error("unknown type: ".concat(e.type))}})(t=>({type:"AccessElement",base:t,index:r.data}),t):r&&"string"===r.type?t=>tp(t=>({type:"AccessAttribute",base:t,name:r.data}),t):t=>tl(t=>({type:"Filter",base:t,expr:e}),t)},slice(t){let e="inc_range"===t.getMark().name;t.shift();let r=t.process(td),n=t.process(td),a=M(r),i=M(n);if(!a||!i||"number"!==a.type||"number"!==i.type)throw new ty("slicing must use constant numbers");return t=>tl(t=>({type:"Slice",base:t,left:a.data,right:i.data,isInclusive:e}),t)},projection(t){let e=t.process(td);return t=>(function(t,e){if(!e)return{type:"b-b",build:t};switch(e.type){case"a-a":return{type:"a-a",build:tc(tu(t),e.build)};case"a-b":return{type:"a-b",build:tc(tu(t),e.build)};case"b-a":return{type:"b-a",build:tc(t,e.build)};case"b-b":return{type:"b-b",build:tc(t,e.build)};default:throw Error("unknown type: ".concat(e.type))}})(t=>({type:"Projection",base:t,expr:e}),t)},attr_access(t){let e=t.processString();return t=>tp(t=>({type:"AccessAttribute",base:t,name:e}),t)},deref(t){let e=null;"deref_attr"===t.getMark().name&&(t.shift(),e=t.processString());let r=t=>e?{type:"AccessAttribute",base:t,name:e}:t;return t=>tp(t=>r({type:"Deref",base:t}),t)},array_postfix:t=>t=>tl(t=>({type:"ArrayCoerce",base:t}),t)},tb={group:t=>(t.process(tb),null),everything(){throw Error("Invalid selector syntax")},this(){throw Error("Invalid selector syntax")},parent(){throw Error("Invalid selector syntax")},dblparent(t){throw Error("Invalid selector syntax")},traverse(t){for(t.process(tb);"traversal_end"!==t.getMark().name;)t.process(tm);return t.shift(),null},this_attr:t=>(t.processString(),null),neg(t){throw Error("Invalid selector syntax")},pos(t){throw Error("Invalid selector syntax")},add(t){throw Error("Invalid selector syntax")},sub(t){throw Error("Invalid selector syntax")},mul(t){throw Error("Invalid selector syntax")},div(t){throw Error("Invalid selector syntax")},mod(t){throw Error("Invalid selector syntax")},pow(t){throw Error("Invalid selector syntax")},comp(t){throw Error("Invalid selector syntax")},in_range(t){throw Error("Invalid selector syntax")},str(t){throw Error("Invalid selector syntax")},integer(t){throw Error("Invalid selector syntax")},float(t){throw Error("Invalid selector syntax")},sci(t){throw Error("Invalid selector syntax")},object(t){throw Error("Invalid selector syntax")},array(t){throw Error("Invalid selector syntax")},tuple(t){throw Error("Invalid selector syntax")},func_call(t,e){let r=td.func_call(t,e);if("anywhere"===r.name&&1===r.args.length)return null;throw Error("Invalid selector syntax")},pipecall(t){throw Error("Invalid selector syntax")},pair(t){throw Error("Invalid selector syntax")},and(t){throw Error("Invalid selector syntax")},or(t){throw Error("Invalid selector syntax")},not(t){throw Error("Invalid selector syntax")},asc(t){throw Error("Invalid selector syntax")},desc(t){throw Error("Invalid selector syntax")},param(t){throw Error("Invalid selector syntax")}};function tw(t,e,r){if("number"==typeof e){if(r!==e)throw new ty("Incorrect number of arguments to function ".concat(t,"(). Expected ").concat(e,", got ").concat(r,"."))}else if(e&&!e(r))throw new ty("Incorrect number of arguments to function ".concat(t,"()."))}class tg extends Error{constructor(t){super("Syntax error in GROQ query at position ".concat(t)),this.name="GroqSyntaxError",this.position=t}}var tk=["Value","Copy","Blank","ReturnIntoArray","ReturnIntoObject","ReturnIntoObjectSameKey","PushField","PushElement","PushParent","Pop","PushFieldCopy","PushFieldBlank","PushElementCopy","PushElementBlank","ReturnIntoObjectPop","ReturnIntoObjectSameKeyPop","ReturnIntoArrayPop","ObjectSetFieldValue","ObjectCopyField","ObjectDeleteField","ArrayAppendValue","ArrayAppendSlice","StringAppendString","StringAppendSlice"],tv=function(){function t(t,e,r){this.i=0,this.inputStack=[],this.outputStack=[],this.model=t,this.root=e,this.patch=r}return t.prototype.read=function(){return this.patch[this.i++]},t.prototype.process=function(){for(this.inputStack.push({value:this.root}),this.outputStack.push({value:this.root});this.i<this.patch.length;){var t=this.read(),e=tk[t];if(!e)throw Error("Unknown opcode: "+t);this["process"+e].apply(this)}var r=this.outputStack.pop();return this.finalizeOutput(r)},t.prototype.inputEntry=function(){return this.inputStack[this.inputStack.length-1]},t.prototype.inputKey=function(t,e){return t.keys||(t.keys=this.model.objectGetKeys(t.value).sort()),t.keys[e]},t.prototype.outputEntry=function(){return this.outputStack[this.outputStack.length-1]},t.prototype.outputArray=function(){var t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyArray(t.value)),t.writeValue},t.prototype.outputObject=function(){var t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyObject(t.value)),t.writeValue},t.prototype.outputString=function(){var t=this.outputEntry();return t.writeValue||(t.writeValue=this.model.copyString(t.value)),t.writeValue},t.prototype.finalizeOutput=function(t){return t.writeValue?this.model.finalize(t.writeValue):t.value},t.prototype.processValue=function(){var t=this.model.wrap(this.read());this.outputStack.push({value:t})},t.prototype.processCopy=function(){var t=this.inputEntry();this.outputStack.push({value:t.value})},t.prototype.processBlank=function(){this.outputStack.push({value:null})},t.prototype.processReturnIntoArray=function(){var t=this.outputStack.pop(),e=this.finalizeOutput(t),r=this.outputArray();this.model.arrayAppendValue(r,e)},t.prototype.processReturnIntoObject=function(){var t=this.read(),e=this.outputStack.pop(),r=this.finalizeOutput(e);r=this.model.markChanged(r);var n=this.outputObject();this.model.objectSetField(n,t,r)},t.prototype.processReturnIntoObjectSameKey=function(){var t=this.inputEntry(),e=this.outputStack.pop(),r=this.finalizeOutput(e),n=this.outputObject();this.model.objectSetField(n,t.key,r)},t.prototype.processPushField=function(){var t=this.read(),e=this.inputEntry(),r=this.inputKey(e,t),n=this.model.objectGetField(e.value,r);this.inputStack.push({value:n,key:r})},t.prototype.processPushElement=function(){var t=this.read(),e=this.inputEntry(),r=this.model.arrayGetElement(e.value,t);this.inputStack.push({value:r})},t.prototype.processPop=function(){this.inputStack.pop()},t.prototype.processPushFieldCopy=function(){this.processPushField(),this.processCopy()},t.prototype.processPushFieldBlank=function(){this.processPushField(),this.processBlank()},t.prototype.processPushElementCopy=function(){this.processPushElement(),this.processCopy()},t.prototype.processPushElementBlank=function(){this.processPushElement(),this.processBlank()},t.prototype.processReturnIntoObjectPop=function(){this.processReturnIntoObject(),this.processPop()},t.prototype.processReturnIntoObjectSameKeyPop=function(){this.processReturnIntoObjectSameKey(),this.processPop()},t.prototype.processReturnIntoArrayPop=function(){this.processReturnIntoArray(),this.processPop()},t.prototype.processObjectSetFieldValue=function(){this.processValue(),this.processReturnIntoObject()},t.prototype.processObjectCopyField=function(){this.processPushField(),this.processCopy(),this.processReturnIntoObjectSameKey(),this.processPop()},t.prototype.processObjectDeleteField=function(){var t=this.read(),e=this.inputEntry(),r=this.inputKey(e,t),n=this.outputObject();this.model.objectDeleteField(n,r)},t.prototype.processArrayAppendValue=function(){var t=this.model.wrap(this.read()),e=this.outputArray();this.model.arrayAppendValue(e,t)},t.prototype.processArrayAppendSlice=function(){var t=this.read(),e=this.read(),r=this.outputArray(),n=this.inputEntry().value;this.model.arrayAppendSlice(r,n,t,e)},t.prototype.processStringAppendString=function(){var t=this.model.wrap(this.read()),e=this.outputString();this.model.stringAppendValue(e,t)},t.prototype.processStringAppendSlice=function(){var t=this.read(),e=this.read(),r=this.outputString(),n=this.inputEntry().value;this.model.stringAppendSlice(r,n,t,e)},t}();function tE(t,e,r){void 0===r&&(r=0);var n=r,a=0;for(a=r;n<e;a++){var i,o=(i=t.codePointAt(a))>>16?4:i>>11?3:i>>7?2:1;4===o&&a++,n+=o}return a}var tS={wrap:function(t){return t},finalize:function(t){return Array.isArray(t)?t:t.data},markChanged:function(t){return t},objectGetKeys:function(t){return Object.keys(t)},objectGetField:function(t,e){return t[e]},arrayGetElement:function(t,e){return t[e]},copyObject:function(t){var e={type:"object",data:{}};if(null!==t)for(var r=0,n=Object.entries(t);r<n.length;r++){var a=n[r],i=a[0],o=a[1];e.data[i]=o}return e},copyArray:function(t){return null===t?[]:t.slice()},copyString:function(t){return{type:"string",data:null===t?"":t}},objectSetField:function(t,e,r){t.data[e]=r},objectDeleteField:function(t,e){delete t.data[e]},arrayAppendValue:function(t,e){t.push(e)},arrayAppendSlice:function(t,e,r,n){t.push.apply(t,e.slice(r,n))},stringAppendSlice:function(t,e,r,n){var a=tE(e,r),i=tE(e,n,a);t.data+=e.slice(a,i)},stringAppendValue:function(t,e){t.data+=e}};let tA=t=>"undefined"!=typeof window&&t.addEventListener===window.EventSource.prototype.addEventListener,t_=t=>!tA(t),tj=(t,e,r)=>{t_(t)?t.addEventListener(e,r):t.addEventListener(e,r,!1)};function tx(t){return t._id.startsWith("drafts.")?t._id.slice(7):t._id}function tO(t,e){let r={...t};return delete r._rev,new tv(tS,r,e).process()}function tI(){return Promise.resolve()}let tP=async function(t){var e,r;let n,a,{projectId:i,dataset:o,token:s,documentLimit:c,includeTypes:u=[]}=t,l="https://".concat(i,".api.sanity.io/v1/data/export/").concat(o),p=u.length>0?new URLSearchParams({types:null==u?void 0:u.join(",")}):"",f="".concat(l,"?").concat(p),y=await fetch(f,{credentials:"include",headers:s?{Authorization:"Bearer ".concat(s)}:void 0});if(200!==y.status)throw Error("Error streaming dataset: ".concat("object"==typeof(e=await y.json())&&"error"in e&&"message"in e?e.message||e.error:"<unknown error>"));let d=function(t){let e;if(!t)throw Error("Failed to read body from response");let r=!1;function n(){r=!0,e&&e.cancel()}return new ReadableStream({start(a){e=t.getReader();let i=new TextDecoder,o="";async function s(t){if(t.done){if(r)return;if(0===(o=o.trim()).length){a.close();return}a.enqueue(JSON.parse(o)),a.close();return}o+=i.decode(t.value,{stream:!0});let c=o.split("\n");for(let t=0;t<c.length-1;++t){let e=c[t].trim();if(0!==e.length)try{a.enqueue(JSON.parse(e))}catch(t){a.error(t),n();return}}if(o=c[c.length-1],e)try{s(await e.read())}catch(t){a.error(t)}}e.read().then(s).catch(t=>a.error(t))},cancel:n})}(y.body),h=d.getReader(),m=[];do{if((r=a=(n=await h.read()).value)&&"error"in r&&"object"==typeof r.error&&null!==r.error&&"description"in r.error&&"string"==typeof r.error.description&&!("_id"in r))throw Error("Error streaming dataset: ".concat(a.error));if(a&&!a._id.startsWith("_.")&&m.push(a),c&&m.length>c)throw h.cancel("Reached document limit"),Error("Error streaming dataset: Reached limit of ".concat(c," documents. Try using the includeTypes option to reduce the amount of documents, or increase the limit."))}while(!n.done);return m};function tC(t){var e;!function(){let t=["EventSource","ReadableStream","fetch"].filter(t=>!(t in window));if(t.length>0)throw Error("Browser not supported. Missing browser APIs: ".concat(t.join(", ")))}();let r=null!=(e=t.EventSource)?e:window.EventSource;if(t.token){if(!t.EventSource)throw Error("When the `token` option is used the `EventSource` option must also be provided.");if(t.EventSource===window.EventSource)throw Error("When the `token` option is used the `EventSource` option must also be provided. EventSource cannot be `window.EventSource`, as it does not support passing a token.")}return function(t,e){let r,o=[],s=function(t,e,r){var n,a={},i=a.noTrailing,o=void 0!==i&&i,s=a.noLeading,c=void 0!==s&&s,u=a.debounceMode,l=void 0===u?void 0:u,p=!1,f=0;function y(){n&&clearTimeout(n)}function d(){for(var r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];var s=this,u=Date.now()-f;function d(){f=Date.now(),e.apply(s,a)}function h(){n=void 0}!p&&(c||!l||n||d(),y(),void 0===l&&u>t?c?(f=Date.now(),o||(n=setTimeout(l?h:d,t))):d():!0!==o&&(n=setTimeout(l?h:d,void 0===l?t-u:t)))}return d.cancel=function(t){var e=(t||{}).upcomingOnly;y(),p=!(void 0!==e&&e)},d}(t.subscriptionThrottleMs||50,function(){c.forEach(p)}),c=[];async function u(){r||(r=function(t,e,r){let n,a,i,o,s,c,{getDocuments:u,EventSource:l}=r,{projectId:p,dataset:f,listen:y,overlayDrafts:d,documentLimit:h,token:m,includeTypes:b}=t,w=t=>{n=void 0,i=void 0,a=void 0,e(d?function(t){let e=new Map;return t.forEach(t=>{let r=e.get(tx(t));t._id.startsWith("drafts.")?e.set(tx(t),{...t,_id:tx(t)}):r||e.set(t._id,t)}),Array.from(e.values())}(t):t)};if(!y){let t=u({projectId:p,dataset:f,documentLimit:h,token:m,includeTypes:b}).then(w).then(tI);return{unsubscribe:tI,loaded:t}}let g=new Map,k=[],v=new Promise((t,e)=>{s=t,c=e}),E=async()=>{let t=await u({projectId:p,dataset:f,documentLimit:h,token:m,includeTypes:b});(o=function(t,e){let r=new Map;return e.forEach(t=>{let e=r.get(t.documentId)||[];e.push(t),r.set(t.documentId,e)}),r.forEach((e,r)=>{let n=t.find(t=>t._id===r);if(!n){console.warn("Received mutation for missing document %s",r);return}let a=!1,i=n;e.forEach(t=>{(a=a||t.previousRev===n._rev)&&t.effects&&(i=tO(i,t.effects.apply))}),t.splice(t.indexOf(n),1,i)}),t}(t,k)).forEach(t=>g.set(t._id,t)),w(o),s()},S=t=>{o?(j(t),_(o,t)):k.push(t)},A=function(t,e,r){var n;let{projectId:a,dataset:i,token:o}=e,s="https://".concat(a,".api.sanity.io/v1/data/listen/").concat(i,"?query=*&effectFormat=mendoza"),c=new t(s,{withCredentials:!0,headers:o?{Authorization:"Bearer ".concat(o)}:void 0});return tj(c,"welcome",r.open),tj(c,"mutation",(n=r.next,t=>{let e;try{e=JSON.parse(t.data)}catch(t){return}n(e)})),tj(c,"channelError",t=>{let e;c.close();try{e=JSON.parse(t.data)}catch(t){r.error(Error("Unknown error parsing listener message"));return}r.error(Error(e.message||e.error||"Listener returned HTTP ".concat(e.statusCode)))}),tj(c,"error",t=>{let e="undefined"!=typeof window&&window.location.origin,n="object"==typeof t&&null!==t&&"message"in t?" (".concat(t.message,")"):"";r.error(Error("Error establishing listener - check that the project ID and dataset are correct".concat(e?", and that the CORS-origin (".concat(e,") is allowed"):"").concat(n)))}),{unsubscribe:()=>Promise.resolve(c.close())}}(l,t,{next:S,open:E,error:t=>c(t)}),_=(t,e)=>{clearTimeout(i),a!==e.transactionId&&n?(w(n),a=void 0):(a=e.transactionId,n=t.slice()),i=setTimeout(w,25,t.slice())},j=t=>{if(!t.effects||t.documentId.startsWith("_."))return;let e=g.get(t.documentId)||null;x(t.documentId,tO(e,t.effects.apply))},x=(t,e)=>{let r=g.get(t),n=o||[],a=r?n.indexOf(r):-1;-1===a&&e?(n.push(e),g.set(t,e)):e?(n.splice(a,1,e),g.set(t,e)):(n.splice(a,1),g.delete(t))};return{unsubscribe:A.unsubscribe,loaded:v}}(t,t=>{o=t,s()},e)),await r.loaded}async function l(t,e){await u();let r=function(t){let e,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(e=0,e=to(t,0),"error"===(r=tr(t,e,0)).type?r:(e=to(t,r.position))!==t.length?(r.failPosition&&(e=r.failPosition-1),{type:"error",position:e}):(delete r.position,delete r.failPosition,r));if("error"===a.type)throw new tg(a.position);let i=new Y(t,a.marks,n);return i.process(td)}(t,{params:e}),n=await function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=w(e.root),n=w(e.dataset),a={...e.params},i=new C(a,n,r,{timestamp:e.timestamp||new Date,identity:void 0===e.identity?"me":e.identity,sanity:e.sanity,after:e.after?w(e.after):null,before:e.before?w(e.before):null},null);return T(t,i)}(r,{dataset:o,params:e});return n.get()}function p(t){return l(t.query,t.params).then(e=>{"previousResult"in t&&i(t.previousResult,e)||(t.previousResult=e,t.callback(void 0,e))}).catch(e=>{t.callback(e)})}return{query:l,getDocument:async function(t){var e,r;return await u(),l((0,a.Z)(n||(e=["*[_id == $id][0]"],r||(r=e.slice(0)),n=Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}})))),{id:t})},getDocuments:async function(t){await u();let e=t.map(t=>'*[_id == "'.concat(t,'"][0]')).join(",\n");return l("[".concat(e,"]"))},subscribe:function(e,r,n){if(!t.listen)throw Error("Cannot use `subscribe()` without `listen: true`");let a={query:e,params:r,callback:n};c.push(a);let i=!1,o=()=>(i||(i=!0,c.splice(c.indexOf(a),1)),Promise.resolve());return p(a),{unsubscribe:o}},close:function(){return s.cancel(),r?r.unsubscribe():Promise.resolve()}}}(t,{EventSource:r,getDocuments:tP})}}}]);